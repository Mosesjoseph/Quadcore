from urllib import urlopen
from xml.etree.ElementTree import parse
from traffic.models import traffic_event
from datetime import datetime
# Download the RSS feed and parse it
#u = urlopen('https://www.i-traffic.co.za/api/incidents?key=c763adacf26b4b7eb5bc81bca8772975&format=xml')
#doc = parse(u)
doc = parse("/home/moses/Quadcore/python files/TrafficAnalyzer/traffic/event.xml")
eventsRoot = doc.getroot()

# Extract and output tags of interest

def getEvents(roadName):  
    events=[]
    event=eventsRoot[0]
    for ev in eventsRoot:
        if(ev[12].text==roadName):        
            roadway_ = event[12].text
            location_ = event[8].text
            direction_ = event[2].text
            description_ = event[1].text
            lanes_ = event[4].text
            updated_ =event[5].text
            
            tmp=traffic_event(roadway_name=roadway_, location=location_, description=description_, direction_of_travel=direction_, lanes_affected=lanes_, timestamp=datetime.now())
            events.insert(0,tmp)
    #res=roadway+","+location+", Direction of travel:"+direction+", Description:"+description+", Affected lanes:"+lanes+", Last updated:"+updated
    #res=[roadway,location,direction,description,lanes,updated]    
    return events


